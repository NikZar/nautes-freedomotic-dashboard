<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Freedomotic - Open IoT Framework</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <!-- build:css styles/main.css -->
        <link rel="stylesheet" href="styles/main.css">
        <!-- endbuild-->

        <!-- Place your HTML imports here -->
        <script src="bower_components/webcomponentsjs/webcomponents.js"></script>
        <link href="bower_components/polymer/polymer.html" rel="import">
        <link rel="import" href="bower_components/core-image/core-image.html">
        <link rel="import" href="bower_components/paper-input/paper-input.html">
        <link rel="import" href="bower_components/paper-button/paper-button.html">
        <link rel="import" href="bower_components/paper-checkbox/paper-checkbox.html">
        <link rel="import" href="bower_components/paper-shadow/paper-shadow.html">
        <link rel="import" href="bower_components/fd-polymer-rest-service/fd-polymer-rest-service.html">
        
    </head>
    <body unresolved>
    <template is="auto-binding">
    <fd-api-settings
    address="{{address}}" apiVersion="{{path}}"
    ssl="{{ssl}}" port="{{port}}" ></fd-api-settings>
    <fd-rest-service
    id="userAPI"
    auto="false"
    fdType="users/{{name}}"
    on-rest-error="{{backToLogin}}"
    on-rest-response="{{gotoApp}}"></fd-rest-service>

    <core-image class="background" src="images/background.jpg" sizing="cover" preload fade></core-image>
    <div layout horizontal layout center class="container">
    <paper-shadow z="2" class="login" layout vertical center >
        <div class="logocontainer" self-stretch>
            <core-image class="logo" src="images/freedomotic-logo-light-transparent.png" sizing="contain" preload fade></core-image>
        </div>
        <div layout vertical self-stretch end-justified style="padding:1em 2em;">
            <paper-input label="Address" id="address" value="{{address}}" floatingLabel></paper-input>
            <paper-input id="name" label="Name" value="{{name}}" floatingLabel></paper-input>
            <paper-input-decorator label="Password" floatingLabel>
                <input id="password" is="core-input" value="{{password}}"  name="password" type="password"/>
            </paper-input-decorator>
            <core-label center horizontal layout style="margin:1em;">
                <div flex>SSL</div>&nbsp;
                <paper-checkbox value="{{ssl}}" for></paper-checkbox>
            </core-label>
            <core-label center horizontal layout style="margin:1em;">
                <div flex>Remember me</div>&nbsp;
                <paper-checkbox for></paper-checkbox>
            </core-label>
            <small style="margin:1em;" on-tap="{{toggleShowAdvanced}}">Show advanced options</small>
            <paper-input hidden?="{{showAdvanced}}" label="Port" id="port" value="{{port}}" floatingLabel></paper-input>
            <paper-input hidden?="{{showAdvanced}}" label="Path" id="path" value="{{path}}" floatingLabel></paper-input>
            <paper-button raised style="margin:1em;" on-tap="{{tryLogin}}">Login</paper-button>
        </div>
    </paper-shadow>
     </div>
     </template>
     <script type="text/javascript">
         var scope = document.querySelector('template[is=auto-binding]');
         scope.backToLogin= function(){
            console.log("LOGIN ERROR");
            // cleanup password field
            // block login button fo 3 seconds
         };
         scope.gotoApp = function(){
            console.log("LOGIN SUCCESS");
            // change url 
            location.assign("pass.html");
         };
         scope.showAdvanced= false;
         scope.toggleShowAdvanced = function(){
            scope.showAdvanced = !scope.showAdvanced;
         };
         scope.tryLogin = function(){
            // find userAPI
            var api = document.querySelector('#userAPI');
            // Create Base64 Object
            var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}

            // set params
            /// console.log(scope.name + ":" + scope.password);
            if (api.$.ajax.headers == undefined) {
                 api.$.ajax.headers = {};
            }
            api.$.ajax.headers.Authorization= "Basic " + Base64.encode(scope.name + ':' + scope.password );
            /// console.log(api.$.ajax.headers.Authorization);
            // call userAPI.go();
            api.go();
         };
     </script>
    </body>
</html>
