<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<!-- 
  `<fd-rest-element-service>` provides an API for the FD rest elements

  Provides a very simple API: ex. fdtype `plugins` returns the list of installed plugins.

  @element plugin-service
-->

<polymer-element name="fd-rest-element-service" attributes="fditems fdtype">
  <template>
    <style>
    :host {
      display: block;
    }
    paper-toast {
      z-index: 1000 !IMPORTANT;
      bottom: 40px;
      left: 10px;
    }
    </style>
    <paper-toast id="toast" text="There was a problem loading {{fdtype}} data.">
      <div style="color: blue;" on-tap="{{retry}}">Retry</div>
    </paper-toast>
    <core-ajax id="ajax" 
      auto on-core-error="{{errorHandler}}"
      url="https://fritz.bestmazzo.it:9113/v3/a{{fdtype}}/"
      disabled-on-core-response="{{elementsLoaded}}"
      response="{{fditems}}"
      handleAs="json"  withCredentials >
    </core-ajax>
  </template>
  <script>
  Polymer('fd-rest-element-service', {
    
    fdtype:'environments',
    
    created: function() {
      this.fditems = [];
    },

    elementsLoaded: function() {
      // Make a copy of the loaded data
      console.log(this.fdtype +" : "+ this.$.ajax.response);
      this.fditems = this.$.ajax.response.slice(0);

      for (var i = fditems.length - 1; i >= 0; i--) {
        console.log("element #"+i);
        console.log(fditems[i]);
      }

    },
    
    errorHandler: function(event){
      console.log(event);
      console.log(this.$.toast);
      this.$.toast.show();
    }
  });
  </script>
</polymer-element>